# PhotoSortX - AI Edition

AIを活用した高機能な画像整理・管理アプリケーション

## 概要

PhotoSortXは、大量の写真を効率的に整理・管理するためのデスクトップアプリケーションです。AI技術を活用した自動分類、重複検出、類似画像検出、ピンボケ検出などの機能を提供します。

## 主な機能

### 📂 メイン機能
- **フォルダ同期**: 指定フォルダ内の画像を自動スキャン・同期
- **ギャラリー表示**: 登録された画像を一覧表示

### 🗑️ クリーンアップ機能
- **重複整理**: MD5ハッシュによる完全一致の重複画像を検出・整理
- **ピンボケ整理**: Laplacian分散によるピンボケ画像の検出・整理
- **類似整理**: VP-Treeアルゴリズムによる類似画像の検出・整理

### 📦 整理機能
- **手動仕分け**: 2ペインモードで直感的に画像を仕分け
- **スマート整理 (AI)**: CLIPモデルによるAI自動分類
- **自動グルーピング**: DBSCANクラスタリングによる自動グループ化

## システム要件

- Python 3.8以上
- Windows 10/11 (他のOSでも動作可能)
- 最低2GB RAM（AI機能使用時は4GB以上推奨）

## インストール

### 1. リポジトリのクローン

```bash
git clone <repository-url>
cd ImageOrganizeForWork
```

### 2. 依存ライブラリのインストール

#### 必須ライブラリのみ（AI機能なし）

```bash
pip install -r requirements.txt
```

#### 全機能を使用する場合

```bash
pip install PyQt6 imagehash opencv-python numpy Pillow torch transformers scikit-learn
```

**注意**: AI機能（スマート整理・自動グルーピング）を使用する場合は、`torch`と`transformers`のインストールが必要です。初回起動時にモデルが自動ダウンロードされます（数GBの容量が必要です）。

## 使い方

### 起動

```bash
python main.py
```

### 基本的なワークフロー

1. **フォルダ同期 (Scan)**
   - 「1. フォルダ同期 (Scan)」ボタンをクリック
   - 整理したい画像フォルダを選択
   - アプリが自動的に画像をスキャンしてデータベースに登録

2. **詳細解析 (Analyze)**
   - 「2. 詳細解析 (Analyze)」ボタンをクリック
   - 画像のハッシュ値、ピンボケスコア、類似度などの解析を実行

3. **整理機能の使用**
   - サイドバーから目的の機能を選択
   - 重複・ピンボケ・類似画像の検出と整理
   - 手動仕分けやAIによる自動分類

## 機能詳細

### 重複整理
- MD5ハッシュによる完全一致の検出
- グリッド/リスト表示の切り替え
- 一括削除機能

### ピンボケ整理
- 閾値スライダーで感度調整
- リアルタイムでリスト更新
- ピンボケ画像の一括削除

### 類似整理
- VP-Treeアルゴリズムによる高速検索
- 距離閾値の調整可能
- 類似画像グループの表示

### スマート整理 (AI)
- CLIPモデルによる画像理解
- フォルダ名から自動学習
- 類似度スコア表示

### 自動グルーピング
- DBSCANクラスタリング
- 最大1000枚まで処理
- グループ単位での移動

## 設定

設定は`config.py`で管理されています。主な設定項目：

- ファイルサイズ制限
- バッチ処理サイズ
- サムネイル設定
- 類似検索閾値
- ピンボケ検出閾値

## データベース

アプリケーションはSQLiteデータベース（`photos.db`）を使用して画像のメタデータを保存します。

- **files**: 画像ファイルのメタデータ
- **thumbnails**: サムネイル画像（BLOB）
- **settings**: アプリケーション設定

## トラブルシューティング

### AI機能が動作しない

- `torch`と`transformers`がインストールされているか確認
- 初回起動時にモデルのダウンロードが完了しているか確認
- インターネット接続が必要です（初回のみ）

### メモリ不足エラー

- 大量の画像を処理する場合は、バッチサイズを小さくする
- `config.py`の`BATCH_SIZE_*`設定を調整

### パフォーマンスが遅い

- データベースのインデックスが正しく作成されているか確認
- 不要な画像を削除してデータベースを最適化
- 「DB全初期化」でデータベースをリセット

## 開発

### プロジェクト構造

```
ImageOrganizeForWork/
├── main.py              # メインアプリケーション
├── core.py              # コア機能（DB、画像処理）
├── config.py            # 設定管理
├── modules/             # UIモジュール
│   ├── duplicate_ui.py  # 重複整理UI
│   ├── blur_ui.py       # ピンボケ整理UI
│   ├── similarity_ui.py  # 類似整理UI
│   ├── sorter_ui.py    # スマート整理UI
│   ├── clustering_ui.py # 自動グルーピングUI
│   ├── manual_sorter_ui.py  # 手動仕分けUI
│   └── ai_classifier.py # AI分類機能
├── requirements.txt     # 依存ライブラリ
└── README.md           # このファイル
```

### テスト

```bash
pytest tests/
```

### ログ

アプリケーションのログは`debug.log`に出力されます。

## ライセンス

このプロジェクトのライセンス情報をここに記載してください。

## 貢献

バグ報告や機能要望は、Issueでお知らせください。

## 更新履歴

### v2.1
- エラーハンドリングの改善
- 型ヒントの追加
- ドキュメントの充実
- セキュリティの強化
- リソース管理の改善

## 作者

[あなたの名前]

## 謝辞

- PyQt6: GUIフレームワーク
- OpenCV: 画像処理
- CLIP (OpenAI): AI画像分類
- scikit-learn: クラスタリング

